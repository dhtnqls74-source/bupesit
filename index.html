<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to EPUB 변환기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .preview-content {
            background-color: #E6E0F8;
            color: #333;
            padding: 2rem;
            border-radius: 0.5rem;
            height: 100%;
            overflow-y: auto;
        }
        .preview-content h1, .preview-content h2, .preview-content p {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .preview-content h1 {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2rem;
        }
        .preview-content h2 {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #C0B8DD;
            padding-bottom: 0.25rem;
        }
        .preview-content p {
            font-size: 1em;
            line-height: 1.8;
            text-align: justify;
            margin-bottom: 1rem;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #6D28D9;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Chosen Palette: Lavender Bliss -->
    <!-- Application Structure Plan: A two-column, task-oriented layout was chosen for clarity and ease of use. The left column serves as the control panel for all user inputs (metadata, HTML content), while the right column provides a live, styled preview. This separation of concerns allows the user to see the immediate effect of their HTML input. The final action, generating the EPUB, is a prominent button. This flow is intuitive: configure, input, preview, generate. -->
    <!-- Visualization & Content Choices: The core of this application is not data visualization but content transformation. Info: User-provided HTML. Goal: Structure and convert to EPUB. Presentation: A `textarea` for input and a styled `div` for a live preview. Interaction: The user's HTML input dynamically updates the preview pane. Justification: This provides immediate visual feedback, which is crucial for a content creation tool. The final output is a downloadable file. Library/Method: Vanilla JS for the live preview and the JSZip library (via CDN) to construct the .epub file package on the client side. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-violet-800">HTML to EPUB 변환기</h1>
            <p class="text-lg text-gray-600 mt-2">간단한 HTML 코드로 나만의 EPUB 전자책을 만들어보세요.</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">정보 입력</h2>
                <div class="space-y-4">
                    <div>
                        <label for="bookTitle" class="block text-sm font-medium text-gray-700">책 제목</label>
                        <input type="text" id="bookTitle" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="예: 연구 시작">
                    </div>
                    <div>
                        <label for="bookAuthor" class="block text-sm font-medium text-gray-700">저자</label>
                        <input type="text" id="bookAuthor" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="예: 홍길동">
                    </div>
                    <div>
                        <label for="htmlContent" class="block text-sm font-medium text-gray-700">HTML 콘텐츠</label>
                        <textarea id="htmlContent" rows="15" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="<h1>제목</h1><p>여기에 내용을 입력하세요...</p>"></textarea>
                    </div>
                    <button id="generateBtn" class="w-full bg-violet-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-violet-800 transition-colors duration-300 flex items-center justify-center">
                        <span id="btnText">EPUB 생성하기</span>
                        <div id="btnLoader" class="loader hidden" style="width: 20px; height: 20px; border-width: 2px;"></div>
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg flex flex-col">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">실시간 미리보기</h2>
                <div id="preview" class="preview-content flex-grow">
                    <h1>제목</h1>
                    <p>이곳에서 콘텐츠가 어떻게 보일지 확인할 수 있습니다.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const bookTitleInput = document.getElementById('bookTitle');
        const bookAuthorInput = document.getElementById('bookAuthor');
        const htmlContentInput = document.getElementById('htmlContent');
        const preview = document.getElementById('preview');
        const generateBtn = document.getElementById('generateBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');

        htmlContentInput.addEventListener('input', updatePreview);
        
        function updatePreview() {
            preview.innerHTML = htmlContentInput.value;
        }
        
        generateBtn.addEventListener('click', async () => {
            const title = bookTitleInput.value || 'Untitled';
            const author = bookAuthorInput.value || 'Unknown Author';
            const content = htmlContentInput.value || '<p>No content provided.</p>';
            
            if (!content) {
                alert('HTML 콘텐츠를 입력해주세요.');
                return;
            }

            setLoading(true);

            try {
                const zip = new JSZip();

                const mimetype = "application/epub+zip";
                zip.file("mimetype", mimetype, {compression: "STORE"});

                const containerXml = `<?xml version="1.0" encoding="UTF-8"?>
<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">
  <rootfiles>
    <rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"/>
  </rootfiles>
</container>`;
                zip.folder("META-INF").file("container.xml", containerXml);

                const uuid = `urn:uuid:${self.crypto.randomUUID()}`;
                const now = new Date().toISOString().slice(0, 19) + 'Z';
                
                const contentOpf = `<?xml version="1.0" encoding="UTF-8"?>
<package xmlns="http://www.idpf.org/2007/opf" unique-identifier="BookId" version="2.0">
  <metadata xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opf="http://www.idpf.org/2007/opf">
    <dc:title>${title}</dc:title>
    <dc:creator opf:role="aut">${author}</dc:creator>
    <dc:identifier id="BookId" opf:scheme="UUID">${uuid}</dc:identifier>
    <dc:language>ko</dc:language>
    <meta name="dtb:uid" content="${uuid}"/>
    <meta name="dtb:depth" content="1"/>
    <meta name="dtb:totalPageCount" content="0"/>
    <meta name="dtb:maxPageNumber" content="0"/>
    <dc:date>${now}</dc:date>
  </metadata>
  <manifest>
    <item id="ncx" href="toc.ncx" media-type="application/x-dtbncx+xml"/>
    <item id="content" href="content.xhtml" media-type="application/xhtml+xml"/>
    <item id="css" href="style.css" media-type="text/css"/>
  </manifest>
  <spine toc="ncx">
    <itemref idref="content"/>
  </spine>
</package>`;
                zip.folder("OEBPS").file("content.opf", contentOpf);
                
                const tocNcx = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ncx PUBLIC "-//NISO//DTD ncx 2005-1//EN" "http://www.daisy.org/z3986/2005/ncx-2005-1.dtd">
<ncx xmlns="http://www.daisy.org/z3986/2005/ncx/" version="2005-1">
  <head>
    <meta name="dtb:uid" content="${uuid}"/>
    <meta name="dtb:depth" content="1"/>
    <meta name="dtb:totalPageCount" content="0"/>
    <meta name="dtb:maxPageNumber" content="0"/>
  </head>
  <docTitle><text>${title}</text></docTitle>
  <navMap>
    <navPoint id="navPoint-1" playOrder="1">
      <navLabel><text>시작</text></navLabel>
      <content src="content.xhtml"/>
    </navPoint>
  </navMap>
</ncx>`;
                zip.folder("OEBPS").file("toc.ncx", tocNcx);

                const css = `
body { background-color: #E6E0F8; color: #333; font-family: 'Noto Sans KR', sans-serif; }
h1, h2, p { font-family: 'Noto Sans KR', sans-serif; }
h1 { font-size: 2em; font-weight: bold; text-align: center; margin-bottom: 2rem; }
h2 { font-size: 1.5em; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #C0B8DD; padding-bottom: 0.25rem; }
p { font-size: 1em; line-height: 1.8; text-align: justify; margin-bottom: 1rem; }
                `;
                zip.folder("OEBPS").file("style.css", css);

                const contentXhtml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>${title}</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
  ${content}
</body>
</html>`;
                zip.folder("OEBPS").file("content.xhtml", contentXhtml);

                const blob = await zip.generateAsync({
                    type: "blob",
                    mimeType: "application/epub+zip"
                });

                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = `${title.replace(/ /g, '_')}.epub`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error("EPUB 생성 오류:", error);
                alert("EPUB 파일을 생성하는 중 오류가 발생했습니다. 콘솔을 확인해주세요.");
            } finally {
                setLoading(false);
            }
        });

        function setLoading(isLoading) {
            if (isLoading) {
                generateBtn.disabled = true;
                btnText.classList.add('hidden');
                btnLoader.classList.remove('hidden');
            } else {
                generateBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
            }
        }

        updatePreview();
    </script>

</body>
</html>
